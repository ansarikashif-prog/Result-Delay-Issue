<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>Report Result Delay ‚Äî JMI CDOE</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
    /* ----------------- Theme & base ----------------- */
    :root{
      --accent: #1d8a42;
      --accent-2: #28c35a;
      --bg: #f4faf6;
      --bg-2: #eaf7ee;
      --card: #ffffff;
      --surface: rgba(255,255,255,0.86);
      --muted: #4d5f4b;
      --border: rgba(6,24,12,0.06);
      --shadow-sm: 0 6px 18px rgba(10,20,10,0.06);
      --shadow-md: 0 12px 34px rgba(6,18,10,0.08);
      --radius: 14px;
      --maxW: 1100px;
      --glass: rgba(255,255,255,0.6);
      --success: #16a34a;
      --danger: #dc2626;
    }
  
    html, body {
      height: 100%;
      min-height: 100%;
    }
  
    /* FIX: remove harmful flex-centering */
    body{
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 400px at 10% 10%, var(--bg-2), transparent 8%),
                  linear-gradient(180deg,var(--bg), #eef7ec 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      color:#07140b;
      margin:0;
      padding:32px;
      display:block; /* FIX */
    }
  
    .container, .main, .wrapper, .layout, .page {
      height: auto !important;
      min-height: 100dvh !important;
    }
  
    /* form grid fix */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
  
    .form-group {
      display: flex;
      flex-direction: column;
      width: 100%;
    }
  
    .form-group input {
      width: 100%;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }
  
    @media (max-width: 600px) {
      .form-grid { grid-template-columns: 1fr; }
    }
  
    *{box-sizing:border-box}
  
    /* top accent bar */
    body::before{
      content:"";
      position:fixed;
      top:0; left:0; right:0;
      height:4px;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      z-index:9999;
    }
  
    .container{
      width:100%;
      max-width:var(--maxW);
      border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.72), rgba(255,255,255,0.9));
      padding:26px;
      box-shadow:var(--shadow-md);
      border:1px solid var(--border);
      backdrop-filter: blur(6px);
      position:relative;
      overflow:hidden;
      margin: 0 auto; /* FIX for small screens */
      animation:fadeInUp .36s ease both;
    }
  
    @keyframes fadeInUp { from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
  
    header{display:flex;gap:18px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .title{display:flex;flex-direction:column;gap:6px}
    h1{
      margin:0;
      font-family:"Plus Jakarta Sans", "Inter", sans-serif;
      font-weight:700;
      color:var(--accent);
      font-size:1.45rem;
      letter-spacing:-0.2px;
    }
    .subtitle{margin:0;color:var(--muted);font-size:13.5px}
  
    .badges{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      background:linear-gradient(180deg,#ffffff,#f3fcf4);
      border-radius:999px;
      padding:8px 12px;
      border:1px solid rgba(34,100,50,0.06);
      box-shadow:var(--shadow-sm);
      color:var(--accent);
      font-weight:700;
      font-size:13px;
    }
    .badge small{color:var(--muted);font-weight:600;font-size:12px;margin-left:6px}
  
    /* layout */
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:18px;align-items:start}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} .preview{min-height:320px} }
  
    /* left panel */
    .card-panel{background:var(--surface); border-radius:12px; padding:18px; border:1px solid var(--border); box-shadow:var(--shadow-sm); backdrop-filter: blur(4px);}
    .fields{display:grid;gap:14px}
    label{font-size:13px;color:#0c2a14;font-weight:700;margin-bottom:6px;display:block}
    .helper{font-size:12px;color:var(--muted);margin-top:6px}
  
    input[type="text"], input[type="tel"]{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(13,30,14,0.06);
      font-size:15px;
      background:linear-gradient(180deg,#fff,#fbfff9);
      transition:box-shadow .18s, transform .12s, border-color .18s;
    }
    input[type="text"]:focus, input[type="tel"]:focus{
      outline:none;
      box-shadow:0 0 0 8px rgba(29,138,66,0.08);
      border-color:var(--accent);
      transform:translateY(-1px);
    }
  
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row > div{flex:1;min-width:140px}
  
    .controls-row{display:flex;gap:10px;align-items:center;margin-top:6px;flex-wrap:wrap}
    .toggle{display:inline-flex;background:rgba(255,255,255,0.9);border-radius:10px;border:1px solid rgba(6,24,12,0.04);overflow:hidden;box-shadow:var(--shadow-sm)}
    .toggle button{padding:8px 12px;border:0;cursor:pointer;background:transparent;font-weight:700;color:var(--muted);font-size:13px}
    .toggle button.active{background:linear-gradient(180deg,var(--accent-2),var(--accent));color:#fff}
  
    .info{background:linear-gradient(180deg,#f6fff6,#f0faf0);border:1px solid rgba(34,100,50,0.06);padding:10px 12px;border-radius:8px;color:var(--muted);font-size:13px}
  
    /* right column preview */
    .preview-wrap{display:flex;flex-direction:column;gap:10px}
    textarea#preview{
      background:linear-gradient(180deg,#fff,#fcfff9);
      padding:16px;
      min-height:280px;
      border-radius:12px;
      border:1px solid rgba(6,24,12,0.04);
      font-size:15px;
      line-height:1.6;
      color:#0f1f15;
      white-space:pre-wrap;
      overflow:auto;
      resize:vertical;
      box-shadow:var(--shadow-sm);
      font-family: "Inter", system-ui, sans-serif;
    }
  
    .controls-bottom{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .rewrite{align-self:flex-end;margin-top:6px;background:#fff;border:1px solid rgba(20,80,30,0.06);padding:8px 10px;border-radius:10px;font-weight:700;color:var(--accent);cursor:pointer;box-shadow:0 8px 22px rgba(18,70,28,0.04);transition:transform .18s, background .18s}
    .rewrite:hover{transform:translateY(-4px); background:linear-gradient(180deg,var(--accent-2),var(--accent)); color:#fff}
  
    .send-row{display:flex;justify-content:center;margin-top:6px}
    .send-btn{
      position:relative;
      background:linear-gradient(180deg,var(--accent),var(--accent-2));
      color:#fff;
      padding:12px 26px;
      border-radius:12px;
      border:0;
      cursor:pointer;
      font-weight:800;
      font-size:15px;
      box-shadow:0 16px 36px rgba(29,138,66,0.18);
      display:inline-flex;
      align-items:center;
      gap:10px;
      transition:transform .14s, box-shadow .14s, width .18s, border-radius .18s;
      min-width:170px;
    }
    .send-btn:active{transform:translateY(1px)}
    .send-btn[disabled]{opacity:.7;cursor:default;box-shadow:none;transform:none}
  
    .send-btn.spinner-mode{
      width:48px;
      border-radius:50%;
      padding:12px;
      justify-content:center;
    }
    .btn-text{display:inline-block; transition:opacity .12s}
    .btn-spinner{ width:18px; height:18px; border-radius:50%; border:3px solid rgba(255,255,255,0.25); border-top-color:#fff; animation:spin .7s linear infinite; display:none }
    .spinner-mode .btn-spinner{display:block}
    .spinner-mode .btn-text{opacity:0}
  
    @keyframes spin { to { transform: rotate(360deg) } }
  
    .note{ text-align:center; color:var(--muted); font-size:13px; margin-top:10px; }
  
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  
    .meta-row{display:flex;gap:8px;align-items:center;justify-content:flex-end}
    .small-btn{background:transparent;border:0;padding:6px 8px;border-radius:8px;cursor:pointer;color:var(--muted);font-weight:700}
    .small-btn.toggle-dark{border:1px solid rgba(6,24,12,0.04); background:linear-gradient(180deg,#fff,#f7fff7)}
    .privacy{font-size:12px;color:var(--muted);margin-top:8px;text-align:center}
  
    .toast{
      position:fixed;
      right:20px;
      bottom:20px;
      background:#0f1f15;
      color:#fff;
      padding:12px 16px;
      border-radius:10px;
      box-shadow:var(--shadow-md);
      opacity:0; transform:translateY(10px);
      transition:opacity .18s, transform .18s;
      z-index:15000;
      font-weight:600;
    }
    .toast.show{opacity:1; transform:none}
  
    .confetti-piece{position:fixed;width:8px;height:12px;z-index:14000;pointer-events:none;opacity:0.95;border-radius:2px}
  
    /* dark mode */
    @media (prefers-color-scheme: dark){
      :root{
        --bg: #07140b;
        --bg-2: #0b1a10;
        --card: #06130b;
        --surface: rgba(12,20,14,0.5);
        --muted: #93a68e;
        --border: rgba(255,255,255,0.03);
      }
      body{ background: radial-gradient(1200px 400px at 10% 10%, rgba(20,30,20,0.2), transparent 8%), linear-gradient(180deg,var(--bg), #05210a 100%); color:#e6f6ea }
      .container{ background: linear-gradient(180deg, rgba(6,18,12,0.5), rgba(6,18,12,0.65)); border:1px solid var(--border) }
      textarea#preview, input[type="text"], input[type="tel"]{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color: #e8f7ea; border:1px solid var(--border) }
      .badge{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color: var(--accent) }
      .send-btn{ box-shadow: 0 12px 30px rgba(30,122,58,0.22) }
      .toast{ background: rgba(255,255,255,0.06); color: #eaffef }
    }
  </style>
  
</head>
<body>
  <div class="container" role="main" aria-labelledby="main-title">
    <header>
      <div class="title">
        <h1 id="main-title">Report: Delay in 2nd-Year Result ‚Äî BA (ODL)</h1>
        <div class="subtitle">Exams finished on <strong>24 Aug 2025</strong>. Use this form to send an individual email to the programme coordinator.</div>
      </div>

      <div class="meta-row">
        <div class="badges" aria-hidden="true">
          <div class="badge" id="daysBadge">üóìÔ∏è Days since exam: --</div>
          <div class="badge" id="totalBadge">üì® Total submissions: 0</div>
        </div>

        <button id="darkToggle" class="small-btn toggle-dark" title="Toggle dark mode">üåô</button>
      </div>
    </header>

    <div class="grid" aria-live="polite">
      <div class="card-panel" aria-label="Form panel">
        <div class="fields" role="form" aria-describedby="formHint">
            <div class="form-grid">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name">
                </div>
            
                <div class="form-group">
                    <label for="roll">Roll No</label>
                    <input type="text" id="roll">
                </div>
            
                <div class="form-group">
                    <label for="enroll">Enrollment No</label>
                    <input type="text" id="enroll">
                </div>
            
                <div class="form-group">
                    <label for="phone">Phone No</label>
                    <input type="text" id="phone">
                </div>
            </div>
            

          <div class="controls-row" aria-hidden="true">
            <div class="toggle" role="tablist" aria-label="Language toggle">
              <button id="btnEng" class="active" aria-pressed="true">English</button>
              <button id="btnHin" aria-pressed="false">Hinglish</button>
            </div>

            <div style="flex:1"></div>

            <div class="info" id="formHint">Why this matters: delayed results cause uncertainty and affect planning for back exams.</div>
          </div>

          <div class="privacy">By sending, you agree this message and minimal metadata (time, roll) will be stored for follow-up.</div>
        </div>
      </div>

      <div class="preview-wrap" aria-label="Preview and actions">
        <textarea id="preview" aria-label="Email preview" spellcheck="true">Please enter Name, Roll No and Enrollment No to auto-generate a personalised email preview.</textarea>

        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
          <div style="display:flex;gap:8px;align-items:center">
            <button id="rewriteBtn" class="rewrite" title="Get a different wording">‚Üª Rewrite</button>
            <div style="font-size:13px;color:var(--muted)">You can edit the preview before sending.</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <div id="charNote" style="font-size:12px;color:var(--muted);visibility:hidden">Length: <span id="charCount">0</span></div>
          </div>
        </div>

        <div class="send-row">
          <button id="sendBtn" class="send-btn" aria-live="polite" aria-label="Send My Concern">
            <span class="btn-spinner" aria-hidden="true"></span>
            <span class="btn-text">Send My Concern</span>
          </button>
        </div>

        <div class="note" id="statusNote">The preview opens automatically as you enter details. Edit before sending if needed.</div>
      </div>
    </div>

    <footer>System for student assistance ‚Äî use responsibly.</footer>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script type="module">
  /* =========================================================
     FINAL Script implementing all confirmed options.
     - Loading animation: button -> spinner (0.6s)
     - Autosave (localStorage)
     - Validation per your rules
     - Firestore save -> mailto with clipboard fallback
     - Rate-limit 10s
     - Templates: 15 English + 15 Hinglish (your exact content)
     - Dark-mode toggle + prefers-color-scheme
     ========================================================= */

  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  /* ============== FIREBASE CONFIG (keep secure rules on server) ============== */
  const firebaseConfig = {
    apiKey: "AIzaSyCt0mvu4CbRQBdBJL5wAxijAdEirBUDCDc",
    authDomain: "justice-for-jmi.firebaseapp.com",
    projectId: "justice-for-jmi",
    storageBucket: "justice-for-jmi.firebasestorage.app",
    messagingSenderId: "17849710989",
    appId: "1:17849710989:web:0b1dd3c9bb77520d98a5c4"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const COLLECTION_NAME = "resultdelayreport";
  const submissionsCol = collection(db, COLLECTION_NAME);

  /* ---------------- DOM ---------------- */
  const nameEl = document.getElementById('name');
  const rollEl = document.getElementById('roll');
  const enrollEl = document.getElementById('enroll');
  const phoneEl = document.getElementById('phone');
  const previewEl = document.getElementById('preview');
  const btnEng = document.getElementById('btnEng');
  const btnHin = document.getElementById('btnHin');
  const rewriteBtn = document.getElementById('rewriteBtn');
  const sendBtn = document.getElementById('sendBtn');
  const daysBadge = document.getElementById('daysBadge');
  const totalBadge = document.getElementById('totalBadge');
  const statusNote = document.getElementById('statusNote');
  const toast = document.getElementById('toast');
  const charNote = document.getElementById('charNote');
  const charCount = document.getElementById('charCount');
  const darkToggle = document.getElementById('darkToggle');

  /* ---------------- Templates (15 English + 15 Hinglish) ---------------- */
  const templatesEnglish = [
  `Respected Sir,

  My name is [NAME], Roll No. [ROLL], Enrollment No. [ENROLL]. I completed my second-year examinations on 24 Aug 2025, and since that date I have not received any update about my result.

  The delay has caused uncertainty because I cannot be sure whether I have cleared all subjects or whether I need to prepare for a re-attempt. Kindly inform when the results will be published, so I can plan my academic steps accordingly.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  I am [NAME], Roll No. [ROLL], Enrollment No. [ENROLL]. My final second-year paper was on 24 Aug 2025. I have been checking for the result but there is no update yet.

  This lack of clarity affects my preparation for the coming year. Please provide an expected timeline for publication or release the results soon.

  Regards,
  [NAME]`,

  `Respected Sir,

  This is [NAME], Roll No. [ROLL], Enrollment [ENROLL]. On 24 Aug 2025 I completed the second-year exams. It has been some time and I still haven't seen the results on the portal.

  If any subject requires re-examination, early notification would help me prepare properly. I kindly request you to announce the results or share a tentative date.

  Thank you,
  [NAME]`,

  `Respected Sir,

  My name is [NAME], Roll No. [ROLL], Enrollment [ENROLL]. Our second-year exams ended on 24 Aug 2025 and the result has not been declared so far.

  The delay is creating anxiety as I do not know my academic status. Please release the results at the earliest or inform us of the expected announcement date.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  I am [NAME], Roll No. [ROLL], Enrollment [ENROLL]. I appeared in the second-year exams which concluded on 24 Aug 2025. The result is still pending.

  I request your kind attention to expedite the result declaration or provide a clear timeline so that I can plan my studies.

  Regards,
  [NAME]`,

  `Respected Sir,

  This is [NAME], Roll No. [ROLL], Enrollment [ENROLL]. My last exam was on 24 Aug 2025. I am waiting for the result and would appreciate an update.

  A timely result will assist in managing study plans for any possible re-attempts. Please let us know when to expect the declaration.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  My name is [NAME], Roll No [ROLL], Enrollment [ENROLL]. Since our exams ended on 24 Aug 2025, I have been awaiting the result announcement but there has been no information.

  It would be very helpful if you could share the expected date for result publication so I can prepare accordingly.

  Thank you,
  [NAME]`,

  `Respected Sir,

  This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. My second-year exams finished on 24 Aug 2025 and I have not received the result yet.

  I humbly request you to share an update or to release the results soon, as clarity is essential for planning.

  Regards,
  [NAME]`,

  `Respected Sir,

  I am [NAME], Roll No [ROLL], Enrollment [ENROLL]. The second-year exam cycle ended on 24 Aug 2025 and results are still pending. This delay is concerning.

  Please provide a timeline for declaration so students can prepare for any required re-attempts.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  My name is [NAME], Roll No [ROLL], Enrollment [ENROLL]. The exams concluded on 24 Aug 2025, yet the results are not published.

  I respectfully request the results be announced at the earliest or for an update about expected publication date.

  Thank you,
  [NAME]`,

  `Respected Sir,

  This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. My 2nd-year exams finished on 24 Aug 2025 and I am still waiting for the results. The delay is affecting my study schedule.

  Kindly look into this and inform us about the expected date of result publication.

  Regards,
  [NAME]`,

  `Respected Sir,

  My name is [NAME], Roll No [ROLL], Enrollment [ENROLL]. I completed the second-year exams on 24 Aug 2025 and would like to request an update on the result timeline.

  Timely communication will help me plan my next steps if any re-exam is required.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  I am [NAME], Roll No [ROLL], Enrollment [ENROLL]. The exams ended on 24 Aug 2025; results remain unpublished. I request your assistance in announcing the results at the earliest possible date.

  Thank you,
  [NAME]`,

  `Respected Sir,

  This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. Since the last paper on 24 Aug 2025 I have been expecting the result. Please provide an update or release the results soon.

  Regards,
  [NAME]`,

  `Respected Sir,

  My name is [NAME], Roll No [ROLL], Enrollment [ENROLL]. The second-year exams ended on 24 Aug 2025 and the result is still awaited. I request a quick update on the publication schedule.

  Sincerely,
  [NAME]`
  ];

  const templatesHinglish = [
  `Respected Sir,

  My name is [NAME], Roll No. [ROLL], Enrollment No. [ENROLL]. Hamare second-year exams 24 Aug 2025 ko khatam hue the, lekin abhi tak result announce nahi hua.

  Is delay ki wajah se mujhe pata nahi chal pa raha ke main sab subjects clear hua hoon ya kisi me re-attempt karna padega. Aap se request hai ke please result ka expected date bata dein ya jald se jald declare karein.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  Main [NAME], Roll No [ROLL], Enrollment [ENROLL] hoon. 24 Aug 2025 ko hamare second-year exams finish hue the; abhi tak result nahi aaya.

  Result delay se samajh me nahi aa raha hai ke aage kese padhayi karni hai. Sir ya to result announce kar den ya ek tentative date bata dein.

  Regards,
  [NAME]`,

  `Respected Sir,

  Mera naam [NAME] hai, Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko hamare exams complete hue the, par result abhi tak publish nahi hua.

  Agar kisi subject me re-attempt karna pade to uski tayyari ke liye waqt chahiye. Sir please result jaldi se share karein.

  Thank you,
  [NAME]`,

  `Respected Sir,

  Mein [NAME], Roll No [ROLL], Enrollment [ENROLL]. Hamare second-year exams 24 Aug 2025 ko khatam hue the aur abhi tak result pending hai. Ye delay mere liye tension ka sabab ban raha hai.

  Please result ko jald declare karein ya ek expected date bata dein.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  Yeh [NAME] hai, Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ke baad se result ka intezaar chal raha hai; abhi tak koi update nahi mili.

  Aap se request hai ke please result ki expected date batayein ya result jald publish karein.

  Regards,
  [NAME]`,

  `Respected Sir,

  Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko hamari second-year papers complete hue the. Abhi tak result nahi aaya aur is se planning mushkil ho rahi hai.

  Aap se request hai ke result jaldi announce karein.

  Thanks,
  [NAME]`,

  `Respected Sir,

  Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko exams finish hue the; result abhi pending hai. Agar koi backlog hua to timely update bahut zaruri hai.

  Please inform or publish the result soon.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ke baad se result ka wait chal raha hai; abhi tak koi news nahi. Please is par dhyan dein.

  Regards,
  [NAME]`,

  `Respected Sir,

  Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko hamare final papers the aur result abhi tak pending hai. Is delay se time kam pad raha hai back exams ki tayyari ke liye.

  Please announce the results soon.

  Thank you,
  [NAME]`,

  `Respected Sir,

  Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. Exams 24 Aug 2025 ko khatam hue the; result abhi tak declare nahi hua. Please result ki update de dein.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ke baad se result pending hai aur students ko clarity nahi mil rahi. Aap se guzarish hai ke result jaldi share karein.

  Regards,
  [NAME]`,

  `Respected Sir,

  Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. Hamare exams 24 Aug 2025 ko khatam hue; ab tak result publish nahi hua. Please provide an expected date.

  Thank you,
  [NAME]`,

  `Respected Sir,

  Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ke baad result ka wait chal raha hai; timely update se students ko kaafi madad milegi.

  Kindly share the result or result date.

  Sincerely,
  [NAME]`,

  `Respected Sir,

  Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko hamare exams finish hue the; abhi tak result pending hai. Please inform or publish the result soon.

  Regards,
  [NAME]`,

  `Respected Sir,

  Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ke baad se result ki information nahin mili. Aap se request hai ke result jald announce karen.

  Sincerely,
  [NAME]`
  ];

  /* ---------------- Utility functions ---------------- */
  function daysSinceExam(){
    const examLocal = new Date(2025,7,24); // Aug 24 2025 (month 0-based)
    const now = new Date();
    const diff = Math.floor((now - examLocal) / (1000*60*60*24));
    return diff >= 0 ? diff : 0;
  }
  function readableTimestamp(){
    const now = new Date();
    const datePart = now.toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' });
    const timePart = now.toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit', hour12:true });
    return `${datePart} ‚Äî ${timePart}`;
  }
  function escapeHtml(str){
    return String(str || '').replace(/[&<>"'`=\/]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#47;','`':'&#96;','=':'&#61;'}[s]));
  }
  function pickIndex(arrLen, prev){ if (!arrLen) return 0; if (arrLen===1) return 0; let idx; do{ idx = Math.floor(Math.random()*arrLen); } while(idx===prev); return idx; }

  /* ---------------- State ---------------- */
  let currentLang = localStorage.getItem('rd_lang') || 'en';
  let currentIndex = null;
  let userEdited = false;
  let lastSendAt = 0;
  const RATE_LIMIT_MS = 10000; // 10 seconds
  const MAILTO_BODY_THRESHOLD = 1900; // keep as confirmed

  /* ---------------- Initialize UI ---------------- */
  function initUI(){
    // language buttons
    if (currentLang === 'hi'){ btnHin.classList.add('active'); btnHin.setAttribute('aria-pressed','true'); btnEng.classList.remove('active'); btnEng.setAttribute('aria-pressed','false'); }
    else { btnEng.classList.add('active'); btnEng.setAttribute('aria-pressed','true'); btnHin.classList.remove('active'); btnHin.setAttribute('aria-pressed','false'); }

    daysBadge.textContent = `üóìÔ∏è Days since exam: ${daysSinceExam()}`;
    setInterval(()=>{ daysBadge.textContent = `üóìÔ∏è Days since exam: ${daysSinceExam()}`; }, 1000*60*60);

    // restore draft
    const draft = JSON.parse(localStorage.getItem('rd_draft_v1') || '{}');
    if (draft.name) nameEl.value = draft.name;
    if (draft.roll) rollEl.value = draft.roll;
    if (draft.enroll) enrollEl.value = draft.enroll;
    if (draft.phone) phoneEl.value = draft.phone;
    if (draft.lang) currentLang = draft.lang;

    syncLangUI();
    generatePreviewAuto();
    setupRealtimeCounter();
    setupDarkMode();
  }

  /* ------------- Realtime total submissions ------------- */
  let unsubSnapshot = null;
  function setupRealtimeCounter(){
    try {
      unsubSnapshot = onSnapshot(submissionsCol, snap => {
        totalBadge.textContent = `üì® Total submissions: ${snap.size}`;
      }, err=>{
        console.error('onSnapshot error', err);
        totalBadge.textContent = `üì® Total submissions: 0`;
      });
    } catch(e){
      console.warn('Realtime counter init failed', e);
      totalBadge.textContent = `üì® Total submissions: --`;
    }
    window.addEventListener('beforeunload', ()=>{ if (typeof unsubSnapshot === 'function') unsubSnapshot(); });
  }

  /* ---------------- Fill template ---------------- */
  function fillTemplateByLang(idx, lang, name, roll, enroll){
    const arr = (lang === 'hi') ? templatesHinglish : templatesEnglish;
    const safeName = escapeHtml(name || '');
    const safeRoll = escapeHtml(roll || '');
    const safeEnroll = escapeHtml(enroll || '');
    let text = (arr[idx % arr.length] || arr[0])
      .replaceAll('[NAME]', safeName)
      .replaceAll('[ROLL]', safeRoll)
      .replaceAll('[ENROLL]', safeEnroll);
    return text;
  }

  /* -------------- Auto-generate preview (debounced) -------------- */
  let debounceTimer = null;
  function generatePreviewAuto(){
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(()=>{
      const name = nameEl.value.trim();
      const roll = rollEl.value.trim();
      const enroll = enrollEl.value.trim();
      if (!name || !roll || !enroll){
        if (!userEdited) previewEl.value = "Please enter Name, Roll No and Enrollment No to auto-generate a personalised email preview.";
        updateCharCount();
        return;
      }
      if (userEdited) { updateCharCount(); return; }
      const arrLen = (currentLang === 'hi') ? templatesHinglish.length : templatesEnglish.length;
      currentIndex = pickIndex(arrLen, currentIndex);
      previewEl.value = fillTemplateByLang(currentIndex, currentLang, name, roll, enroll);
      updateCharCount();
    }, 220);
  }

  /* ---------- Event bindings for inputs ---------- */
  [nameEl, rollEl, enrollEl, phoneEl].forEach(el=>{
    el.addEventListener('input', ()=>{
      userEdited = false;
      autosaveDraft();
      generatePreviewAuto();
    });
    el.addEventListener('paste', ()=> setTimeout(()=>{ userEdited=false; generatePreviewAuto(); autosaveDraft(); }, 30));
  });

  previewEl.addEventListener('input', ()=>{ userEdited = true; updateCharCount(); autosaveDraft(); });

  function autosaveDraft(){
    const draft = {
      name: nameEl.value.trim(),
      roll: rollEl.value.trim(),
      enroll: enrollEl.value.trim(),
      phone: phoneEl.value.trim(),
      lang: currentLang
    };
    try { localStorage.setItem('rd_draft_v1', JSON.stringify(draft)); } catch(e){ /* ignore */ }
  }

  function updateCharCount(){
    const len = previewEl.value ? previewEl.value.length : 0;
    charCount.textContent = len;
    if (len > MAILTO_BODY_THRESHOLD) {
      charNote.style.visibility = 'visible';
      charNote.textContent = `Length: ${len} (long message ‚Äî will use clipboard fallback)`;
    } else {
      charNote.style.visibility = 'hidden';
    }
  }

  /* ---------------- Language toggles ---------------- */
  btnEng.addEventListener('click', ()=>{
    currentLang = 'en'; localStorage.setItem('rd_lang','en'); syncLangUI();
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if (name && roll && enroll){
      currentIndex = pickIndex(templatesEnglish.length, currentIndex);
      previewEl.value = fillTemplateByLang(currentIndex, currentLang, name, roll, enroll);
      userEdited = false;
      autosaveDraft();
      updateCharCount();
    }
  });
  btnHin.addEventListener('click', ()=>{
    currentLang = 'hi'; localStorage.setItem('rd_lang','hi'); syncLangUI();
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if (name && roll && enroll){
      currentIndex = pickIndex(templatesHinglish.length, currentIndex);
      previewEl.value = fillTemplateByLang(currentIndex, currentLang, name, roll, enroll);
      userEdited = false;
      autosaveDraft();
      updateCharCount();
    }
  });
  function syncLangUI(){
    if (currentLang === 'hi'){ btnHin.classList.add('active'); btnHin.setAttribute('aria-pressed','true'); btnEng.classList.remove('active'); btnEng.setAttribute('aria-pressed','false'); }
    else { btnEng.classList.add('active'); btnEng.setAttribute('aria-pressed','true'); btnHin.classList.remove('active'); btnHin.setAttribute('aria-pressed','false'); }
  }

  /* ---------------- Rewrite */
  rewriteBtn.addEventListener('click', ()=>{
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if (!name || !roll || !enroll){ alert('Please fill Name, Roll No and Enrollment No first.'); return; }
    const arrLen = (currentLang === 'hi') ? templatesHinglish.length : templatesEnglish.length;
    currentIndex = pickIndex(arrLen, currentIndex);
    previewEl.style.opacity = '0.35';
    setTimeout(()=>{
      previewEl.value = fillTemplateByLang(currentIndex, currentLang, name, roll, enroll);
      previewEl.style.opacity = '1';
      userEdited = false;
      autosaveDraft();
      updateCharCount();
    }, 140);
  });

  /* ---------------- Validation rules (as confirmed) ---------------- */
  function validateForm(){
    const name = nameEl.value.trim();
    const roll = rollEl.value.trim();
    const enroll = enrollEl.value.trim();
    const phone = phoneEl.value.trim();

    // name: min 2 max 20
    if (name.length < 2 || name.length > 20) return { ok:false, msg:'Name must be between 2 and 20 characters.' };

    // roll: allow alphanum and hyphen; example D23BA0000 -> require 5-12 chars
    const rollClean = roll.replace(/\s+/g,'');
    if (!/^[A-Za-z0-9\-]{5,12}$/.test(rollClean)) return { ok:false, msg:'Roll No should be 5‚Äì12 characters, alphanumeric (hyphen allowed). Example: D23BA0000' };

    // enroll: min 5 max 10, allow digits and hyphen. pattern like 23-123456 is suggested but flexible
    const enrollClean = enroll.replace(/\s+/g,'');
    if (enrollClean.length < 5 || enrollClean.length > 10 || !/^[0-9\-]+$/.test(enrollClean)) return { ok:false, msg:'Enrollment No must be 5‚Äì10 characters (digits and hyphen). Example: 23-123456' };

    // phone: optional; if provided simple check: digits 7-15 with optional + and spaces
    if (phone){
      const ph = phone.replace(/[ \-()]/g,'');
      if (!/^\+?[0-9]{7,15}$/.test(ph)) return { ok:false, msg:'Phone number appears invalid. Use digits, optionally +, 7‚Äì15 digits.' };
    }

    return { ok:true };
  }

  /* ---------------- Send flow: save to Firestore then mailto (with clipboard fallback) ---------------- */
  async function handleSend(){
    // rate limit
    const now = Date.now();
    if (now - lastSendAt < RATE_LIMIT_MS){
      showToast('Please wait a moment before sending again.');
      return;
    }

    const v = validateForm();
    if (!v.ok){ alert(v.msg); return; }

    const name = nameEl.value.trim();
    const roll = rollEl.value.trim();
    const enroll = enrollEl.value.trim();
    const phone = phoneEl.value.trim();
    const mailBody = (previewEl.value && previewEl.value.trim().length>0) ? previewEl.value.trim() : fillTemplateByLang(currentIndex ?? 0, currentLang, name, roll, enroll);

    // disable button and show spinner transform
    enterSpinnerMode();

    statusNote.textContent = 'Saving your submission...';

    const docData = {
      name, roll, enrollment: enroll, phone: phone || null,
      language: currentLang === 'hi' ? 'hinglish' : 'english',
      templateIndex: currentIndex ?? 0,
      mailBody,
      readableTime: readableTimestamp(),
      ts: serverTimestamp()
    };

    try {
      await addDoc(submissionsCol, docData);
      statusNote.textContent = 'Saved. Preparing your mail...';

      const to = 'g.mgaffar@jmi.ac.in';
      const bcc = 'mrizvi@jmi.ac.in';
      const subject = 'Regarding Delay in Declaration of BA ODL 2nd-Year Results';
      const subjectEnc = encodeURIComponent(subject);
      const bodyEnc = encodeURIComponent(mailBody);
      const mailto = `mailto:${encodeURIComponent(to)}?bcc=${encodeURIComponent(bcc)}&subject=${subjectEnc}&body=${bodyEnc}`;

      // small artificial loading to show spinner per your choice (short 0.6s)
      await new Promise(res => setTimeout(res, 600));

      // clipboard fallback if too long
      if (bodyEnc.length > MAILTO_BODY_THRESHOLD){
        try {
          await navigator.clipboard.writeText(mailBody);
          const shortBody = encodeURIComponent('Dear Sir,\n\nI have prepared a message and copied it to my clipboard. Please paste it into the email body.\n\nRegards,\n');
          const mailtoShort = `mailto:${encodeURIComponent(to)}?bcc=${encodeURIComponent(bcc)}&subject=${subjectEnc}&body=${shortBody}`;
          window.location.href = mailtoShort;
          showToast('Message copied to clipboard. Mail window opened ‚Äî paste and send.');
        } catch (copyErr){
          console.warn('clipboard failed', copyErr);
          // fallback to opening full mailto (may fail)
          window.location.href = mailto;
          showToast('Mail window opened. If body missing, copy message manually.');
        }
      } else {
        // safe to open regular mailto
        window.location.href = mailto;
        showToast('Mail window opened. Please send the message from your mail app.');
      }

      lastSendAt = Date.now();
      // success UI: confetti + toast
      setTimeout(()=>{ triggerConfetti(); showToast('Saved & mail window opened.'); }, 300);
    } catch (err){
      console.error('Save error', err);
      alert('There was an error saving your submission. Please try again.');
      showToast('Save failed. Try again.');
    } finally {
      exitSpinnerMode();
      statusNote.textContent = 'If your mail app did not open, allow pop-ups or try again.';
    }
  }

  /* ---------------- Spinner mode helpers ---------------- */
  function enterSpinnerMode(){
    sendBtn.setAttribute('disabled','true');
    sendBtn.classList.add('spinner-mode');
    const spinner = sendBtn.querySelector('.btn-spinner');
    const text = sendBtn.querySelector('.btn-text');
    text.textContent = 'Sending‚Ä¶';
    // keep spinner visible via CSS .spinner-mode
  }
  function exitSpinnerMode(){
    sendBtn.removeAttribute('disabled');
    sendBtn.classList.remove('spinner-mode');
    const text = sendBtn.querySelector('.btn-text');
    text.textContent = 'Send My Concern';
  }

  /* ---------------- Toast ---------------- */
  let toastTimer = null;
  function showToast(msg, timeout=3800){
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>{ toast.classList.remove('show'); }, timeout);
  }

  /* ---------------- Simple confetti (DOM-based) ---------------- */
  function triggerConfetti(){
    const colors = ['#FF5C5C','#FFD166','#06D6A0','#4D96FF','#B388EB'];
    const count = 18;
    for (let i=0;i<count;i++){
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      const w = 6 + Math.round(Math.random()*8);
      const h = 10 + Math.round(Math.random()*12);
      el.style.width = w + 'px';
      el.style.height = h + 'px';
      el.style.left = (window.innerWidth/2 - 30 + (Math.random()*120 - 60)) + 'px';
      el.style.top = (window.innerHeight/2 - 30 + (Math.random()*40 - 20)) + 'px';
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      el.style.transform = `rotate(${Math.random()*360}deg)`;
      document.body.appendChild(el);
      const angle = (Math.random()*140 - 70);
      const vx = Math.cos(angle*Math.PI/180) * (4 + Math.random()*6);
      const vy = - (6 + Math.random()*10);
      el.animate([
        { transform: `translateY(0px) rotate(${Math.random()*360}deg)`, opacity:1 },
        { transform: `translate(${vx*80}px, ${vy*80 + 200}px) rotate(${Math.random()*720}deg)`, opacity:0 }
      ], {
        duration: 1200 + Math.random()*600,
        easing: 'cubic-bezier(.2,.8,.2,1)'
      });
      setTimeout(()=> el.remove(), 2200 + Math.random()*400);
    }
  }

  /* ---------------- Dark mode toggle ---------------- */
  function setupDarkMode(){
    // use prefers-color-scheme as default; allow toggle
    const userPref = localStorage.getItem('rd_dark');
    if (userPref === 'on') document.documentElement.setAttribute('data-theme','dark');
    else if (userPref === 'off') document.documentElement.removeAttribute('data-theme');
    // small toggle button: just toggles preference (if currently dark -> light, else dark)
    darkToggle.addEventListener('click', ()=>{
      const isDark = document.documentElement.hasAttribute('data-theme');
      if (isDark){
        document.documentElement.removeAttribute('data-theme');
        localStorage.setItem('rd_dark','off');
        darkToggle.textContent = 'üåô';
      } else {
        document.documentElement.setAttribute('data-theme','dark');
        localStorage.setItem('rd_dark','on');
        darkToggle.textContent = '‚òÄÔ∏è';
      }
    });
    // set initial icon
    const isDark = document.documentElement.hasAttribute('data-theme') || window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    darkToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
  }

  /* ---------------- Event binding for Send & charCount ---------------- */
  sendBtn.addEventListener('click', handleSend);

  /* ---------------- Initial preview on load ---------------- */
  document.addEventListener('DOMContentLoaded', initUI);

  /* ---------------- Clean up on unload ---------------- */
  window.addEventListener('unload', ()=>{ try { if (typeof unsubSnapshot === 'function') unsubSnapshot(); } catch(e){} });

  /* ---------------- Accessibility: keyboard shortcut (Ctrl+Enter) to send ---------------- */
  previewEl.addEventListener('keydown', (e)=>{
    if (e.ctrlKey && e.key === 'Enter') {
      e.preventDefault();
      handleSend();
    }
  });

</script>
</body>
</html>
