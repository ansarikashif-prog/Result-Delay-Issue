<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Report: 2nd Year Result Delay — JMI CDOE</title>
<style>
  :root{
    --accent:#1a73e8;
    --muted:#6b7280;
    --bgA:#eef3f8;
    --card:#fff;
    --preview:#fbfdff;
    --maxWidth:980px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    background: linear-gradient(180deg,var(--bgA), #f9fbff);
    display:flex;align-items:center;justify-content:center;
    min-height:100vh;padding:20px;color:#111;
  }

  .container{
    width:100%;max-width:var(--maxWidth);background:var(--card);
    border-radius:14px;padding:22px;box-shadow:0 12px 36px rgba(11,38,78,0.08);
  }

  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  h1{margin:0;font-size:1.5rem;color:#0b3a91}
  .sub{color:var(--muted);font-size:14px}

  .row{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
  .col{flex:1;min-width:220px}
  label{display:block;margin-bottom:6px;font-weight:700;font-size:13px;color:#222}
  input[type=text]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #d6dbe6;font-size:15px;background:#fff}
  input[type=text]:focus{outline:none;box-shadow:0 0 0 5px rgba(26,115,232,0.06);border-color:var(--accent)}

  .controls{display:flex;align-items:center;gap:10px;margin-top:14px;flex-wrap:wrap}
  .toggle{display:inline-flex;border-radius:10px;overflow:hidden;border:1px solid #d6dbe6;background:#fff}
  .toggle button{padding:8px 14px;border:none;background:transparent;cursor:pointer;font-weight:600}
  .toggle button.active{background:var(--accent);color:#fff}
  .badge{padding:8px 12px;border-radius:999px;background:#fff;border:1px solid #e6eefc;color:#0b4ea2;font-weight:700}

  .info{margin-top:12px;padding:10px 12px;border-radius:8px;background:#f4f8ff;border:1px solid #e5efff;color:#0b3a91;font-size:13px}

  .preview-wrap{position:relative;margin-top:16px}
  .preview{
    width:100%;min-height:210px;padding:18px;border-radius:10px;background:var(--preview);
    border:1px solid #e7eef8;font-size:15px;line-height:1.6;color:#1c1c1c;
    white-space:pre-wrap;overflow:auto;transition:opacity .18s ease;
  }

  .rewrite{position:absolute;right:12px;bottom:12px;background:#fff;border:1px solid #d4d9e6;padding:6px 10px;border-radius:8px;cursor:pointer;box-shadow:0 6px 18px rgba(11,38,78,0.06);font-weight:600}

  .send-wrap{display:flex;justify-content:center;margin-top:18px}
  .send-btn{background:var(--accent);color:#fff;border:none;padding:12px 28px;border-radius:10px;font-size:16px;cursor:pointer;box-shadow:0 12px 30px rgba(26,115,232,0.16)}
  .send-btn[disabled]{opacity:.6;cursor:default}

  .status{margin-top:12px;text-align:center;color:var(--muted);font-size:14px}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

  @media (max-width:720px){
    .row{flex-direction:column}
    .preview{min-height:260px}
    .send-btn{width:100%}
  }
</style>
</head>
<body>
  <div class="container" role="main" aria-labelledby="title">
    <header>
      <div>
        <h1 id="title">Report: 2nd Year Result Delay (BA ODL — 2023)</h1>
        <div class="sub">Exams ended on <strong>24 Aug 2025</strong>. Use this form to send an individual request.</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="badge" id="daysBadge">Days since exam: --</div>
        <div class="badge" id="totalBadge">Total submissions: 0</div>
      </div>
    </header>

    <div class="row" style="margin-top:16px">
      <div class="col">
        <label for="name">Your Name *</label>
        <input id="name" type="text" placeholder="e.g. Zaid Khan" autocomplete="name">
      </div>
      <div class="col">
        <label for="roll">Roll Number *</label>
        <input id="roll" type="text" placeholder="e.g. D23BA0000">
      </div>
      <div class="col">
        <label for="enroll">Enrollment No *</label>
        <input id="enroll" type="text" placeholder="e.g. 12-3456">
      </div>
    </div>

    <div class="controls">
      <div class="toggle" role="tablist" aria-label="Language">
        <button id="btnEng" class="active" aria-pressed="true">English</button>
        <button id="btnHin" aria-pressed="false">Hinglish</button>
      </div>
      <div style="flex:1"></div>
      <div class="info">Why this matters: delayed result causes uncertainty, reduces time for back exams, and affects planning.</div>
    </div>

    <div class="preview-wrap">
      <div id="preview" class="preview" contenteditable="true" aria-label="Email preview">
        Please enter Name, Roll No and Enrollment No to generate an individual email preview.
      </div>
      <button id="rewrite" class="rewrite" title="Get a different wording">↻ Rewrite</button>
    </div>

    <div class="send-wrap">
      <button id="send" class="send-btn">Send My Concern</button>
    </div>

    <div id="status" class="status"></div>
    <footer>This tool is created to assist students in raising academic concerns.</footer>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // ====== REPLACE with your Firebase config ======
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTHDOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MSG_SENDER",
    appId: "YOUR_APP_ID"
  };
  // =================================================

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const submissionsCol = collection(db, "submissions");

  // ------------- TEMPLATES -------------
  // All templates use "24 Aug 2025" in text and have one blank line between paragraphs.
  const templatesEnglish = [
`Respected Sir,

My name is [NAME], Roll No. [ROLL], Enrollment No. [ENROLL]. I completed my second-year examinations on 24 Aug 2025, and I am writing because I have not received any update regarding the result.

This delay is causing uncertainty as I cannot confirm whether I have cleared all subjects or if any re-attempt will be required. Timely declaration would allow me to plan my studies and prepare properly if needed.

I kindly request you to please announce the result soon or share an expected date for publication.

Sincerely,
[NAME]`,

`Respected Sir,

I am [NAME], Roll No [ROLL], Enrollment [ENROLL]. My last second-year exam was on 24 Aug 2025. I have been regularly checking the portal but there is no update about the result yet.

Without the result I cannot be sure of my academic status or whether I need to prepare for any back paper. I humbly request that the results be released as soon as possible or that an approximate timeline be provided.

Thank you,
[NAME]`,

`Respected Sir,

This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. Our second-year exams concluded on 24 Aug 2025. It has been some time and the results are still pending.

The delay makes planning difficult, because if any subject requires re-attempt, adequate preparation time is needed. Kindly consider publishing the results soon or sharing an expected date.

Regards,
[NAME]`,

`Respected Sir,

My name is [NAME], Roll No [ROLL], Enrollment [ENROLL]. I appeared for the second-year exams which finished on 24 Aug 2025, and I have not yet seen any result update.

Receiving the result will help me understand whether I need to allocate time for re-examination preparation. I request that the result be announced at the earliest convenience.

Sincerely,
[NAME]`,

`Respected Sir,

I am [NAME], Roll No [ROLL], Enrollment [ENROLL]. I completed my second-year exams on 24 Aug 2025 and I am writing to ask for an update on the result declaration.

This delay is causing uncertainty and makes it hard to plan for the next academic steps. Please share the expected date for publication or release the results soon.

Warm regards,
[NAME]`,

`Respected Sir,

This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. My second-year exam schedule ended on 24 Aug 2025, and I have not received the result yet.

Knowing the result is essential so that I can prepare if any reattempts are required. I kindly request an update or a tentative publication date.

Thank you,
[NAME]`,

`Respected Sir,

My name is [NAME], Roll No [ROLL], Enrollment [ENROLL]. The second-year exams concluded on 24 Aug 2025; however, I have not received any information about the results.

The delay causes stress and uncertainty. I request you to please inform us about the expected date of declaration.

Sincerely,
[NAME]`,

`Respected Sir,

I am [NAME], Roll No [ROLL], Enrollment [ENROLL]. Our second-year exams finished on 24 Aug 2025, yet the results remain unpublished.

I would be grateful if you could provide an update or release the results soon so that I can plan accordingly.

Regards,
[NAME]`,

`Respected Sir,

This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. My final second-year paper was on 24 Aug 2025, and I am still awaiting the result.

Please provide an update regarding the result announcement date or release the results at the earliest opportunity.

Thank you,
[NAME]`,

`Respected Sir,

My name is [NAME], Roll No [ROLL], Enrollment [ENROLL]. The examinations ended on 24 Aug 2025 and results are still awaited. The delay is affecting my study planning.

I request you to kindly announce the results or share a timeline for publication.

Sincerely,
[NAME]`
];

  const templatesHinglish = [
`Respected Sir,

My name is [NAME], Roll No. [ROLL], Enrollment No. [ENROLL]. Hamare second-year exams 24 Aug 2025 ko khatam hue the, lekin ab tak result aane me der ho rahi hai.

Result delay ki wajah se mujhe pata nahi chal raha ke main sab subjects clear hua hoon ya kisi me re-attempt chahiye. Kripya result jaldi publish karne ki koshish karein ya ek estimated date bata dein.

Sincerely,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL], Enrollment [ENROLL] hoon. 24 Aug 2025 ko second-year exams complete hue the; abhi tak result declare nahi hua.

Is delay se planning aur tayyari par asar pad raha hai. Aap se request hai ke kripya expected result date batayein ya result jald announce karein.

Regards,
[NAME]`,

`Respected Sir,

Mera naam [NAME] hai, Roll No [ROLL], Enrollment [ENROLL]. Hamare second-year ke exams 24 Aug 2025 ko khatam hue the par result abhi tak publish nahi hua.

Result na milne ki wajah se clarity nahi mil rahi ke kya kisi subject me back hai. Please is mamle par dhyan dein aur result ka update share karein.

Thank you,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko exams complete hue the aur abhi tak result nahi aaya. Ye uncertainty students ke liye tension create kar rahi hai.

Aap se nivedan hai ke result jaldi publish kar den ya expected date provide karen.

Sincerely,
[NAME]`,

`Respected Sir,

Yeh [NAME] hai, Roll No [ROLL], Enrollment [ENROLL]. 24/08/2025 ke baad se result pending hai; abhi tak koi update nahi mila.

Kripya result ki expected date batayein ya jald se jald declare kar den.

Regards,
[NAME]`,

`Respected Sir,

Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko hamare exams khatam hue the, par result announce nahi hua. Is se planning mushkil ho rahi hai.

Please result publish kar den ya expected date bata dein.

Thanks,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ke baad se result ka intezaar chal raha hai. Agar kisi subject me problem hai to timely update milna chahiye.

Aap se request hai ke kripya result ki information share karein.

Sincerely,
[NAME]`,

`Respected Sir,

Mera naam [NAME], Roll No [ROLL] hai. Hamare second-year exams 24 Aug 2025 ko khatam hue the; abhi tak result pending hai. Ye delay pareshaani ka sabab ban raha hai.

Kindly result jaldi announce kar den.

Regards,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko last exam tha; result abhi tak nahi aaya. Is delay ki wajah se students ka planning par farq pad raha hai.

Please notify or publish the result soon.

Thank you,
[NAME]`,

`Respected Sir,

Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL] hai. 24 Aug 2025 ke baad se result pending hai aur abhi tak koi update nahi hai. Kripya is par dhyan dein aur result declare karen.

Sincerely,
[NAME]`
  ];

  // ---------- STATE & DOM ----------
  const daysBadge = document.getElementById("daysBadge");
  const totalBadge = document.getElementById("totalBadge");
  const previewEl = document.getElementById("preview");
  const nameEl = document.getElementById("name");
  const rollEl = document.getElementById("roll");
  const enrollEl = document.getElementById("enroll");
  const btnEng = document.getElementById("btnEng");
  const btnHin = document.getElementById("btnHin");
  const rewriteBtn = document.getElementById("rewrite");
  const sendBtn = document.getElementById("send");
  const statusEl = document.getElementById("status");

  let currentLang = "en";
  let lastTwo = [];
  let currentIndex = null;
  let userEdited = false;

  // update days since exam
  function updateDays(){
    const exam = new Date("2025-08-24T00:00:00Z");
    const now = new Date();
    const diff = Math.floor((now - exam) / (1000*60*60*24));
    daysBadge.textContent = `Days since exam: ${diff >= 0 ? diff : 0}`;
  }
  updateDays();
  setInterval(updateDays, 1000*60*60);

  // realtime total submissions
  onSnapshot(submissionsCol, snap => {
    totalBadge.textContent = `Total submissions: ${snap.size}`;
  });

  function pickIndex(len){
    let i = Math.floor(Math.random() * len);
    if(lastTwo.includes(i)) i = (i + 1) % len;
    lastTwo.push(i);
    if(lastTwo.length > 2) lastTwo.shift();
    return i;
  }

  function fillTemplate(idx, lang, name, roll, enroll){
    const arr = lang === "en" ? templatesEnglish : templatesHinglish;
    let t = arr[idx];
    t = t.replaceAll("[NAME]", name).replaceAll("[ROLL]", roll).replaceAll("[ENROLL]", enroll);
    return t;
  }

  function autoPreview(){
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if(!name || !roll || !enroll){
      if(!userEdited) previewEl.textContent = "Please enter Name, Roll No and Enrollment No to generate an email preview.";
      return;
    }
    if(userEdited) return;
    const arrLen = templatesEnglish.length;
    currentIndex = pickIndex(arrLen);
    previewEl.textContent = fillTemplate(currentIndex, currentLang, name, roll, enroll);
  }

  nameEl.addEventListener("input", ()=>{ userEdited = false; autoPreview(); });
  rollEl.addEventListener("input", ()=>{ userEdited = false; autoPreview(); });
  enrollEl.addEventListener("input", ()=>{ userEdited = false; autoPreview(); });
  previewEl.addEventListener("input", ()=>{ userEdited = true; });

  // language toggle
  btnEng.addEventListener("click", ()=>{
    currentLang = "en";
    btnEng.classList.add("active"); btnEng.setAttribute("aria-pressed","true");
    btnHin.classList.remove("active"); btnHin.setAttribute("aria-pressed","false");
    const name = nameEl.value.trim(), r = rollEl.value.trim(), e = enrollEl.value.trim();
    if(name && r && e){
      previewEl.textContent = fillTemplate(currentIndex ?? pickIndex(templatesEnglish.length), currentLang, name, r, e);
      userEdited = false;
    }
  });
  btnHin.addEventListener("click", ()=>{
    currentLang = "hi";
    btnHin.classList.add("active"); btnHin.setAttribute("aria-pressed","true");
    btnEng.classList.remove("active"); btnEng.setAttribute("aria-pressed","false");
    const name = nameEl.value.trim(), r = rollEl.value.trim(), e = enrollEl.value.trim();
    if(name && r && e){
      previewEl.textContent = fillTemplate(currentIndex ?? pickIndex(templatesEnglish.length), currentLang, name, r, e);
      userEdited = false;
    }
  });

  // rewrite
  rewriteBtn.addEventListener("click", ()=>{
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if(!name || !roll || !enroll){ alert("Please fill Name, Roll No and Enrollment No first."); return; }
    previewEl.style.opacity = "0.25";
    setTimeout(()=>{
      currentIndex = pickIndex(templatesEnglish.length);
      previewEl.textContent = fillTemplate(currentIndex, currentLang, name, roll, enroll);
      userEdited = false;
      previewEl.style.opacity = "1";
    },160);
  });

  // SEND: save to Firestore first, then open mailto (reliable across devices)
  sendBtn.addEventListener("click", async ()=>{
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if(!name || !roll || !enroll){ alert("Please fill Name, Roll No and Enrollment No first."); return; }

    sendBtn.disabled = true;
    statusEl.textContent = "Saving your submission...";

    // prepare body with one-blank-line paragraphs (\n\n)
    const bodyText = (previewEl.textContent && previewEl.textContent.trim().length>0) ?
                    previewEl.textContent.trim() :
                    fillTemplate(currentIndex ?? 0, currentLang, name, roll, enroll);

    // Subject decided earlier by you
    const subjectText = "Regarding Pending Declaration of Second-Year Result (BA 2023 Batch)";

    try{
      // Save to Firestore
      await addDoc(submissionsCol, {
        name, roll, enrollment: enroll, lang: currentLang,
        templateIndex: currentIndex ?? 0, mailBody: bodyText,
        readableTime: new Date().toLocaleString("en-IN", { timeZone: "Asia/Kolkata" }),
        ts: serverTimestamp()
      });

      statusEl.textContent = "Saved. Opening your mail app...";

      // Build mailto (one blank line between paragraphs -> \n\n)
      // encodeURIComponent will encode line breaks as %0A
      const to = "g.mgaffar@jmi.ac.in";
      const bcc = "mrizvi@jmi.ac.in";
      const subjectEnc = encodeURIComponent(subjectText);
      const bodyEnc = encodeURIComponent(bodyText); // retains \n\n as %0A%0A

      const mailto = `mailto:${to}?bcc=${bcc}&subject=${subjectEnc}&body=${bodyEnc}`;

      // Open device mail app
      window.location.href = mailto;

      // small delay to allow navigation (page may unload)
      setTimeout(()=>{ sendBtn.disabled = false; }, 2000);

    } catch (err){
      console.error("Save error:", err);
      alert("Could not save submission. Please try again.");
      statusEl.textContent = "Error saving submission.";
      sendBtn.disabled = false;
    }
  });

  // initial preview placeholder
  previewEl.textContent = "Please enter Name, Roll No and Enrollment No to generate an email preview.";
</script>
</body>
</html>
