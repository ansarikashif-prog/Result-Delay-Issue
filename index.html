<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Report: 2nd Year Result Delay — JMI CDOE</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  :root{
    --accent:#1a73e8;
    --muted:#6b7280;
    --bgA:#eef3f8;
    --card:#fff;
    --preview:#fbfdff;
    --maxWidth:980px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    background: linear-gradient(180deg,var(--bgA), #f9fbff);
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:20px;
    color:#111;
  }

  .container{
    width:100%;
    max-width:var(--maxWidth);
    background:var(--card);
    border-radius:14px;
    padding:22px;
    box-shadow:0 12px 36px rgba(11,38,78,0.08);
  }

  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  h1{margin:0;font-size:1.5rem;color:#0b3a91}
  .sub{color:var(--muted);font-size:14px}

  .row{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
  .col{flex:1;min-width:220px}
  label{display:block;margin-bottom:6px;font-weight:700;font-size:13px;color:#222}
  input[type=text]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #d6dbe6;font-size:15px;background:#fff}
  input[type=text]:focus{outline:none;box-shadow:0 0 0 5px rgba(26,115,232,0.06);border-color:var(--accent)}

  .controls{display:flex;align-items:center;gap:10px;margin-top:14px;flex-wrap:wrap}
  .toggle{display:inline-flex;border-radius:10px;overflow:hidden;border:1px solid #d6dbe6;background:#fff}
  .toggle button{padding:8px 14px;border:none;background:transparent;cursor:pointer;font-weight:600}
  .toggle button.active{background:var(--accent);color:#fff}
  .badge{padding:8px 12px;border-radius:999px;background:#fff;border:1px solid #e6eefc;color:#0b4ea2;font-weight:700}

  .info{margin-top:12px;padding:10px 12px;border-radius:8px;background:#f4f8ff;border:1px solid #e5efff;color:#0b3a91;font-size:13px}

  .preview-wrap{position:relative;margin-top:16px}
  .preview{
    width:100%;
    min-height:210px;
    padding:18px;
    border-radius:10px;
    background:var(--preview);
    border:1px solid #e7eef8;
    font-size:15px;
    line-height:1.6;
    color:#1c1c1c;
    white-space:pre-wrap;
    overflow:auto;
    transition:opacity .18s ease;
  }

  .rewrite{
    position:absolute;
    right:12px;
    bottom:12px;
    background:#fff;border:1px solid #d4d9e6;padding:6px 10px;border-radius:8px;cursor:pointer;
    box-shadow:0 6px 18px rgba(11,38,78,0.06);font-weight:600
  }

  .send-wrap{display:flex;justify-content:center;margin-top:18px}
  .send-btn{background:var(--accent);color:#fff;border:none;padding:12px 28px;border-radius:10px;font-size:16px;cursor:pointer;box-shadow:0 12px 30px rgba(26,115,232,0.16)}
  .send-btn:disabled{opacity:.6;cursor:default}

  .status{margin-top:12px;text-align:center;color:var(--muted);font-size:14px}

  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

  /* RESPONSIVE TWEAKS */
  @media (max-width:720px){
    .row{flex-direction:column}
    .preview{min-height:260px}
    .send-btn{width:100%}
  }
</style>
</head>
<body>
  <div class="container" role="main" aria-labelledby="title">
    <header>
      <div>
        <h1 id="title">Report: 2nd Year Result Delay (BA ODL — 2023)</h1>
        <div class="sub">Exams ended on <strong>24 August 2025</strong>. Use this form to send an individual request.</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="badge" id="daysBadge">Days since exam: --</div>
        <div class="badge" id="totalBadge">Total submissions: 0</div>
      </div>
    </header>

    <div class="row" style="margin-top:16px">
      <div class="col">
        <label for="name">Your Name *</label>
        <input id="name" type="text" placeholder="e.g. Zaid Khan" autocomplete="name">
      </div>
      <div class="col">
        <label for="roll">Roll Number *</label>
        <input id="roll" type="text" placeholder="e.g. D23BA0000">
      </div>
      <div class="col">
        <label for="enroll">Enrollment No *</label>
        <input id="enroll" type="text" placeholder="e.g. 12-3456">
      </div>
    </div>

    <div class="controls">
      <div class="toggle" role="tablist" aria-label="Language">
        <button id="btnEng" class="active" aria-pressed="true">English</button>
        <button id="btnHin" aria-pressed="false">Hinglish</button>
      </div>
      <div style="flex:1"></div>
      <div class="info">Why this matters: delayed result causes uncertainty, reduces time for back exams, and affects planning.</div>
    </div>

    <div class="preview-wrap">
      <div id="preview" class="preview" contenteditable="true" aria-label="Email preview">
        Please enter Name, Roll No and Enrollment No to generate an individual email preview.
      </div>
      <button id="rewrite" class="rewrite" title="Get a different wording">↻ Rewrite</button>
    </div>

    <div class="send-wrap">
      <button id="send" class="send-btn">Send My Concern</button>
    </div>

    <div id="status" class="status"></div>
    <footer>This tool is created to assist students in raising academic concerns.</footer>
  </div>

<script type="module">
  // Firebase v11 modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // ====== REPLACE this with your Firebase config ======
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTHDOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MSG_SENDER",
    appId: "YOUR_APP_ID"
  };
  // ====================================================

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const submissionsCol = collection(db, "submissions");

  // ---------- Templates (10 English, 10 Hinglish - varied patterns) ----------
  const templatesEnglish = [
`Respected Sir,

My name is [NAME], Roll No. [ROLL], Enrollment No. [ENROLL]. I completed my second-year examinations on 24 August 2025. Since then, I have been waiting for the result but there has been no update.

This delay creates uncertainty because I cannot confirm whether I have cleared all subjects or need to prepare for any back paper. Timely declaration helps students plan their studies and manage time for any re-attempts if required.

I humbly request that the result be released at the earliest or that an expected date be shared so I can plan accordingly.

Sincerely,
[NAME]`,

`Respected Sir,

I am [NAME], Roll No [ROLL], Enrollment No [ENROLL]. My 2nd-year exams concluded on 24 August 2025. I have been regularly checking for the result update, but no information has been provided yet.

The uncertainty is affecting my ability to plan for the upcoming academic period. If any paper requires a re-attempt, I will need adequate time to prepare. I kindly request you to announce the result soon or provide a tentative timeline.

Regards,
[NAME]`,

`Respected Sir,

This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. Our second-year exams ended on 24 August 2025, and it has been some time without result publication.

Without result confirmation, I cannot be certain about my academic standing. The delay has caused confusion and stress for planning further studies. Please provide an update or expected date of result declaration.

Thank you,
[NAME]`,

`Respected Sir,

I am [NAME], Roll No [ROLL], Enrollment [ENROLL]. My last exam was on 24 Aug 2025; however, the result has not been declared yet. I am writing to request an update so I can know whether I have cleared my subjects.

An early announcement will help me decide whether I need to prepare for any back papers and plan my schedule accordingly.

Sincerely,
[NAME]`,

`Respected Sir,

My name is [NAME], Roll No [ROLL], Enrolment [ENROLL]. I appeared for the second-year examinations which concluded on 24 August 2025. The result is still awaited and the delay is causing uncertainty.

Please consider releasing the result as early as possible or share a clear timeline for publication. Your prompt attention would be greatly appreciated.

Warm regards,
[NAME]`,

`Respected Sir,

This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. My second-year exams finished on 24 August 2025, and I am yet to receive any result information.

Knowing the result will clarify whether further preparation is needed. I respectfully request an update or an expected announcement date at your convenience.

Thank you,
[NAME]`,

`Respected Sir,

I am [NAME], Roll No [ROLL], Enrollment [ENROLL]. Since the exams concluded on 24 August 2025, I have been waiting for the result announcement. The delay is making it hard to plan.

Please release the result or inform us when we can expect the declaration so students can prepare accordingly.

Regards,
[NAME]`,

`Respected Sir,

My name is [NAME], Roll No [ROLL], Enrollment No [ENROLL]. Our second-year exams ended on 24 August 2025, and the result has not been published. This delay creates uncertainty about academic standing.

I request you to kindly provide an update about the result release date so I can plan my next steps.

Sincerely,
[NAME]`,

`Respected Sir,

This is [NAME], Roll No [ROLL], Enrollment [ENROLL]. I appeared for the second-year examinations and the last paper was on 24 August 2025. Even now the result has not been declared.

I kindly request the result to be announced at the earliest or that a tentative date be provided for clarity.

Thank you,
[NAME]`,

`Respected Sir,

My name is [NAME], Roll No [ROLL], Enrollment No [ENROLL]. The second-year exams were completed on 24 August 2025, and the results have not yet been published. The delay is making academic planning difficult.

I humbly request you to consider releasing the results soon or sharing an expected announcement date.

Warm regards,
[NAME]`
];

  const templatesHinglish = [
`Respected Sir,

My name is [NAME], Roll No. [ROLL], Enrollment No. [ENROLL]. Hamare second-year exams 24 August 2025 ko khatam hue the, lekin abhi tak result declare nahi hua hai.

Result delay ki wajah se mujhe clarity nahi mil rahi ke sab subjects clear hue ya kisi me back required hai. Agar back hai to next preparation ke liye waqt chahiye hoga. Kindly request kar raha hoon ke result jald se jald announce kar diya jaye ya expected date bata di jaye.

Sincerely,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL], Enrollment [ENROLL] hoon. 24 August 2025 ko second-year exams complete hue the. Ab tak result aane me der ho rahi hai.

Is delay ki wajah se planning aur preparations par asar pad raha hai. Aap se darkhwast hai ke kripya result announce karen ya ek tentative date provide karen.

Regards,
[NAME]`,

`Respected Sir,

Mera naam [NAME] hai, Roll No [ROLL], Enrollment [ENROLL]. Hamare second-year ke exams 24-08-2025 ko khatam hue the, par result abhi tak publish nahi hua.

Result na milne se students ko pata nahi chalta ke kon sa subject clear hua ya nahi. Kripya is matter par dhyan dein aur result ki possible date inform karein.

Thank you,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 August 2025 ko hamare exams finish hue the lekin abhi tak result nahi aaya. Ye delay students ke liye tension create kar raha hai.

Meherbani karke result jaldi publish kar den ya ek expected date bata den, taaki hum aage ki planning kar saken.

Sincerely,
[NAME]`,

`Respected Sir,

Yeh [NAME] hai, Roll No [ROLL], Enrollment [ENROLL]. 24/08/2025 ke baad se result pending hai. Jab tak result nahi aata, mujhe pata nahi chalta ke mujhe kisi subject ki tayyari karni hai ya nahi.

Aap se nivedan hai ke kripya result ka update share karen.

Regards,
[NAME]`,

`Respected Sir,

Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 August 2025 ko hamara last paper tha aur tab se result ka intezaar chal raha hai. Abhi tak koi update nahi aayi.

Kripya kindly result announce kar dein ya expected date bataen, taaki student apni planning theek se kar saken.

Thanks,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL] hoon. Hamare second-year ka exam 24 Aug 2025 ko khatm hua. Result pending hone se kaafi uncertainty hai.

Aap se request hai ke kindly result ko jald declare kar den.

Sincerely,
[NAME]`,

`Respected Sir,

Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24 Aug 2025 ko exams khatam hue the, aur ab tak result declare nahi hua. Ye delay pareshan kar raha hai.

Kripya result jaldi announce karen ya ek tentative timeline bata den.

Regards,
[NAME]`,

`Respected Sir,

Main [NAME], Roll No [ROLL], Enrollment [ENROLL]. 24/08/2025 ke baad se result ka wait chal raha hai. Agar koi backlog hai to uski preparation ke liye time chahiye.

Please announce result soon or let us know expected date.

Thank you,
[NAME]`,

`Respected Sir,

Mera naam [NAME], Roll No [ROLL], Enrollment [ENROLL] hai. 2nd year exams 24 Aug 2025 ko khatam hue; ab tak result pending hai. Is delay se planning mushkil ho rahi hai.

Meherbani karke result jaldi publish kar den.

Sincerely,
[NAME]`
];

  // ---------- STATE ----------
  const daysBadge = document.getElementById("daysBadge");
  const totalBadge = document.getElementById("totalBadge");
  const previewEl = document.getElementById("preview");
  const nameEl = document.getElementById("name");
  const rollEl = document.getElementById("roll");
  const enrollEl = document.getElementById("enroll");
  const btnEng = document.getElementById("btnEng");
  const btnHin = document.getElementById("btnHin");
  const rewriteBtn = document.getElementById("rewrite");
  const sendBtn = document.getElementById("send");
  const statusEl = document.getElementById("status");

  let currentLang = "en";
  let lastTwo = [];
  let currentIndex = null;
  let userEdited = false;

  // days since exam
  function updateDays(){
    const exam = new Date("2025-08-24T00:00:00Z");
    const now = new Date();
    const diff = Math.floor((now - exam) / (1000*60*60*24));
    daysBadge.textContent = `Days since exam: ${diff >= 0 ? diff : 0}`;
  }
  updateDays();
  setInterval(updateDays, 1000*60*60);

  // total submissions -> realtime
  onSnapshot(submissionsCol, snap => {
    totalBadge.textContent = `Total submissions: ${snap.size}`;
  });

  // helper: pick non-repeating index
  function pickIndex(arrLength){
    let i = Math.floor(Math.random()*arrLength);
    if(lastTwo.includes(i)){
      i = (i+1) % arrLength;
    }
    lastTwo.push(i);
    if(lastTwo.length > 2) lastTwo.shift();
    return i;
  }

  function fillTemplate(idx, lang, name, roll, enroll){
    const arr = lang === "en" ? templatesEnglish : templatesHinglish;
    const t = arr[idx];
    return t.replaceAll("[NAME]", name).replaceAll("[ROLL]", roll).replaceAll("[ENROLL]", enroll);
  }

  // generate preview automatically when fields present
  function autoPreview(){
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if(!name || !roll || !enroll){
      if(!userEdited) previewEl.textContent = "Please enter Name, Roll No and Enrollment No to generate an email preview.";
      return;
    }
    if(userEdited) return;
    currentIndex = pickIndex(templatesEnglish.length);
    previewEl.textContent = fillTemplate(currentIndex, currentLang, name, roll, enroll);
  }

  nameEl.addEventListener("input", ()=>{ userEdited = false; autoPreview(); });
  rollEl.addEventListener("input", ()=>{ userEdited = false; autoPreview(); });
  enrollEl.addEventListener("input", ()=>{ userEdited = false; autoPreview(); });
  previewEl.addEventListener("input", ()=> { userEdited = true; });

  // language toggle
  btnEng.addEventListener("click", ()=> {
    currentLang = "en";
    btnEng.classList.add("active"); btnEng.setAttribute("aria-pressed","true");
    btnHin.classList.remove("active"); btnHin.setAttribute("aria-pressed","false");
    const name = nameEl.value.trim(), r = rollEl.value.trim(), e = enrollEl.value.trim();
    if(name && r && e){
      previewEl.textContent = fillTemplate(currentIndex ?? pickIndex(templatesEnglish.length), currentLang, name, r, e);
      userEdited = false;
    }
  });
  btnHin.addEventListener("click", ()=> {
    currentLang = "hi";
    btnHin.classList.add("active"); btnHin.setAttribute("aria-pressed","true");
    btnEng.classList.remove("active"); btnEng.setAttribute("aria-pressed","false");
    const name = nameEl.value.trim(), r = rollEl.value.trim(), e = enrollEl.value.trim();
    if(name && r && e){
      previewEl.textContent = fillTemplate(currentIndex ?? pickIndex(templatesEnglish.length), currentLang, name, r, e);
      userEdited = false;
    }
  });

  // rewrite -> new random template
  rewriteBtn.addEventListener("click", ()=>{
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if(!name || !roll || !enroll){ alert("Please fill Name, Roll No and Enrollment No first."); return; }
    previewEl.style.opacity = "0.25";
    setTimeout(()=>{
      currentIndex = pickIndex(templatesEnglish.length);
      previewEl.textContent = fillTemplate(currentIndex, currentLang, name, roll, enroll);
      userEdited = false;
      previewEl.style.opacity = "1";
    },160);
  });

  // ---------- SEND FLOW: open Gmail first, then save to Firestore ----------
  sendBtn.addEventListener("click", async ()=>{
    const name = nameEl.value.trim(), roll = rollEl.value.trim(), enroll = enrollEl.value.trim();
    if(!name || !roll || !enroll){ alert("Please fill Name, Roll No and Enrollment No first."); return; }

    const bodyText = (previewEl.textContent && previewEl.textContent.trim().length>0) ? previewEl.textContent.trim() : fillTemplate(currentIndex ?? 0, currentLang, name, roll, enroll);
    const subject = encodeURIComponent("Request for Early Declaration of Result – BA ODL 2023 Batch");
    const bodyEnc = encodeURIComponent(bodyText);

    // Build Gmail compose URL: To -> Gaffar; BCC -> mrizvi (as requested)
    const to = "g.mgaffar@jmi.ac.in";
    const bcc = "mrizvi@jmi.ac.in";
    const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(to)}&bcc=${encodeURIComponent(bcc)}&su=${subject}&body=${bodyEnc}`;

    // Open Gmail first so popup is allowed by browser
    const win = window.open(gmailUrl, "_blank");
    if(!win){
      alert("Popup blocked. Please allow popups for this site and try again.");
      return;
    }

    // Immediately save a record to Firestore (Option A)
    statusEl.textContent = "Recording your submission...";

    try{
      await addDoc(submissionsCol, {
        name, roll, enrollment: enroll,
        lang: currentLang,
        templateIndex: currentIndex ?? 0,
        mailBody: bodyText,
        submittedAt: new Date().toISOString(),
        ts: serverTimestamp()
      });
      statusEl.textContent = "Saved locally. Gmail opened — review & send.";
      // update total count appears through onSnapshot automatically
    } catch (err){
      console.error("Save error:", err);
      statusEl.textContent = "Could not save submission — please try again.";
    }
  });

  // initial preview hint
  previewEl.textContent = "Please enter Name, Roll No and Enrollment No to generate an email preview.";
</script>
</body>
</html>
